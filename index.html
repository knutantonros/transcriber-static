<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Add these meta tags for CORS -->
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    <title>Ljudtranskribering & Sammanfattning</title>
    <!-- Make sure CSS path is correct -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add inline style for debugging -->
    <style>
        /* Backup styles in case external CSS fails to load */
        .debug-info {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f44336;
            color: white;
            padding: 10px;
            z-index: 9999;
            text-align: center;
            font-family: sans-serif;
        }
        /* Basic styling if external CSS fails */
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .btn {
            padding: 8px 16px;
            background: #1e88e5;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Debug info bar -->
    <div class="debug-info">
        CSS/JS Debug Mode - Check Console (F12) for Errors
        <button onclick="this.parentNode.style.display='none'">Close</button>
    </div>

    <div class="container">
        <header>
            <h1>Ljudtranskribering & Sammanfattning</h1>
            <p>Ladda upp ljudfiler och få transkription + sammanfattning</p>
        </header>

        <div class="settings-panel">
            <div class="settings-header">
                <h2>Inställningar</h2>
                <button id="toggle-settings" class="btn-icon">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
            
            <div class="settings-content">
                <div class="setting-group">
                    <label for="api-key">OpenAI API-nyckel för sammanfattning</label>
                    <input type="password" id="api-key" placeholder="sk-...">
                    <p class="hint">Krävs för sammanfattningsfunktionen. Sparas endast i din webbläsare.</p>
                </div>
                
                <div class="setting-group">
                    <label for="model-select">Välj transkriptionsmodell</label>
                    <select id="model-select">
                        <option value="whisper-tiny">KB Whisper Tiny (snabb)</option>
                        <option value="whisper-base">KB Whisper Base</option>
                        <option value="whisper-small" selected>KB Whisper Small</option>
                        <option value="whisper-medium">KB Whisper Medium</option>
                        <option value="whisper-large">KB Whisper Large (noggrann)</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="summary-length">Sammanfattningslängd</label>
                    <div class="range-with-labels">
                        <span>Mycket kort</span>
                        <input type="range" id="summary-length" min="1" max="5" value="3">
                        <span>Mycket lång</span>
                    </div>
                </div>
                
                <div class="setting-group">
                    <label for="language-select">Språk</label>
                    <select id="language-select">
                        <option value="sv" selected>Svenska</option>
                        <option value="en">Engelska</option>
                        <option value="auto">Automatisk igenkänning</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="upload">Ladda upp fil</button>
            <button class="tab-btn" data-tab="record">Spela in ljud</button>
        </div>

        <div class="tab-content">
            <!-- Upload Tab -->
            <div id="upload" class="tab-pane active">
                <div class="upload-area" id="drop-area">
                    <input type="file" id="file-input" accept="audio/*,video/*" hidden>
                    <div class="upload-message">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Dra och släpp din ljud- eller videofil här</p>
                        <p>eller</p>
                        <button id="select-file-btn" class="btn primary">Välj fil</button>
                    </div>
                    <div class="file-info" style="display: none;">
                        <p id="filename"></p>
                        <button id="process-file-btn" class="btn primary">Transkribera och sammanfatta</button>
                        <button id="remove-file-btn" class="btn secondary">Ta bort</button>
                    </div>
                </div>
            </div>

            <!-- Record Tab -->
            <div id="record" class="tab-pane">
                <div class="record-controls">
                    <button id="start-record-btn" class="btn primary record-btn">
                        <i class="fas fa-microphone"></i> Starta inspelning
                    </button>
                    <button id="stop-record-btn" class="btn secondary record-btn" style="display: none;">
                        <i class="fas fa-stop"></i> Stoppa inspelning
                    </button>
                    
                    <div id="recording-indicator" style="display: none;">
                        <span class="recording-dot"></span>
                        <span id="recording-time">00:00</span>
                    </div>
                    
                    <div id="audio-player-container" style="display: none;">
                        <audio id="audio-player" controls></audio>
                        <button id="process-recording-btn" class="btn primary">Transkribera och sammanfatta</button>
                        <button id="discard-recording-btn" class="btn secondary">Ta bort</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="processing-section" style="display: none;">
            <div class="progress-container">
                <h3 id="processing-stage">Bearbetar ljud...</h3>
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p id="processing-info">Detta kan ta några minuter beroende på filens längd och vald modell.</p>
            </div>
        </div>

        <div id="results-section" style="display: none;">
            <div class="results-tabs">
                <button class="results-tab-btn active" data-result="transcription">Transkribering</button>
                <button class="results-tab-btn" data-result="summary">Sammanfattning</button>
            </div>
            
            <div class="results-content">
                <div id="transcription-result" class="result-pane active">
                    <div class="result-actions">
                        <button id="copy-transcription" class="btn-icon"><i class="fas fa-copy"></i></button>
                        <button id="download-transcription-txt" class="btn-icon"><i class="fas fa-file-alt"></i></button>
                        <button id="download-transcription-docx" class="btn-icon"><i class="fas fa-file-word"></i></button>
                    </div>
                    <div id="transcription-text" class="result-text"></div>
                </div>
                
                <div id="summary-result" class="result-pane">
                    <div class="result-actions">
                        <button id="copy-summary" class="btn-icon"><i class="fas fa-copy"></i></button>
                        <button id="download-summary-txt" class="btn-icon"><i class="fas fa-file-alt"></i></button>
                    </div>
                    <div id="summary-text" class="result-text"></div>
                </div>
            </div>
        </div>

        <footer>
            <p>Version: 1.0.0 | © 2024</p>
        </footer>
    </div>

    <!-- Debug script - add basic functionality to verify JS is working -->
    <script>
        // Immediately display a debug message to confirm basic JS is working
        console.log("Basic script checking - JavaScript is running");
        
        // Check if CSS is loaded
        window.addEventListener('load', function() {
            const styleSheets = document.styleSheets;
            let cssLoaded = false;
            
            for (let i = 0; i < styleSheets.length; i++) {
                try {
                    // Check if we have any rules from our CSS file
                    if (styleSheets[i].href && styleSheets[i].href.includes('styles.css')) {
                        cssLoaded = true;
                        console.log("CSS file loaded successfully:", styleSheets[i].href);
                        break;
                    }
                } catch (e) {
                    console.error("Error checking stylesheet:", e);
                }
            }
            
            if (!cssLoaded) {
                console.error("CSS file not loaded properly!");
                document.querySelector('.debug-info').innerHTML += "<br><strong>CSS file not loaded!</strong>";
            }
        });
    </script>

    <!-- Load external libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.5.0"></script>

    <!-- Try loading each script individually with error handling -->
    <script>
        // Helper function to load scripts with error handling
        function loadScript(src, callback) {
            const script = document.createElement('script');
            script.src = src;
            
            script.onload = function() {
                console.log(`Script loaded successfully: ${src}`);
                if (callback) callback(null, src);
            };
            
            script.onerror = function() {
                console.error(`Error loading script: ${src}`);
                document.querySelector('.debug-info').innerHTML += `<br><strong>Failed to load: ${src}</strong>`;
                if (callback) callback(new Error(`Failed to load ${src}`), src);
            };
            
            document.body.appendChild(script);
        }

        // Load application scripts in sequence
        const scripts = [
            'js/config.js',
            'js/storage.js',
            'js/audio-processor.js',
            'js/transcription.js',
            'js/summarization.js',
            'js/ui.js',
            'js/app.js'
        ];

        let index = 0;
        function loadNextScript() {
            if (index >= scripts.length) return;
            
            loadScript(scripts[index], function(error) {
                index++;
                if (!error) {
                    loadNextScript();
                }
            });
        }
        
        // Start loading scripts
        loadNextScript();
    </script>
</body>
</html>
